# Usage with Vite

### Installation

~~Since Vite supports Rollup plugin~~ Since Vite provides more features and flexibility, WyW-in-JS has a separate plugin for it `@wyw-in-js/vite`. Vite handles CSS by itself, you don't need a css plugin.

```sh
# npm
npm i -D @wyw-in-js/vite
# yarn
yarn add --dev @wyw-in-js/vite
# pnpm
pnpm add -D @wyw-in-js/vite
# bun
bun add -d @wyw-in-js/vite
```

### Configuration

```js
import { defineConfig } from 'vite';
import wyw from '@wyw-in-js/vite';

export default defineConfig(() => ({
  // ...
  plugins: [wyw()],
}));
```

### `import.meta.env` during evaluation

WyW-in-JS evaluates a subset of your code at build time to extract styles. When that code relies on Vite's `import.meta.env.*`,
the Vite plugin injects Vite env values into the evaluation context so the expressions behave like they do in Vite runtime.

The injected object is available as `__wyw_import_meta_env` and includes:

- Vite's `MODE`, `BASE_URL`, `DEV`, `PROD`, `SSR`
- variables loaded via `loadEnv()` respecting `envPrefix` (by default `VITE_`)

If you need to override values, you can provide your own `overrideContext` option and set `__wyw_import_meta_env` explicitly.

### Keeping CSS comments

Stylis strips CSS comments by default. To preserve them (for example, `/*rtl:ignore*/`), pass `keepComments`:

```js
export default defineConfig(() => ({
  // ...
  plugins: [wyw({ keepComments: true })],
}));
```

Vite also strips CSS comments during build minification by default. To keep them in the final output, disable CSS minification:

```js
export default defineConfig(() => ({
  // ...
  build: { cssMinify: false },
  plugins: [wyw({ keepComments: true })],
}));
```

If you are using language features that requires a babel transform (such as typescript), ensure the proper babel presets or plugins are passed to wyw.

```js
import { defineConfig } from 'vite';
import wyw from '@wyw-in-js/vite';

// example to support typescript syntax:
export default defineConfig(() => ({
  // ...
  plugins: [
    wyw({
      include: ['**/*.{ts,tsx}'],
      babelOptions: {
        presets: ['@babel/preset-typescript', '@babel/preset-react'],
      },
    }),
  ],
}));
```
